<!doctype html>
<html lang="ja">
    <head>
        <meta charset="UTF-8" />
        <meta name="viewport" content="width=device-width, initial-scale=1.0" />
        <title>News App</title>
        <!-- Bootstrap CDN -->
        <link
            href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.2/dist/css/bootstrap.min.css"
            rel="stylesheet"
        />
        <style>
        /* ローディングスピナー中央表示 */
        #loading {
            display: none; /* 最初は非表示 */
            position: fixed;
            top: 0; left: 0;
            width: 100%; height: 100%;
            background: rgba(0,0,0,0.4);
            z-index: 1000;
            justify-content: center;
            align-items: center;
            flex-direction: column;
            color: white;
        }
        </style>
    </head>

    <body class="bg-light">
        <div class="container py-4">
        <h1 class="mb-4 text-center">News Search</h1>

        <!-- 検索フォーム -->
        <p>アメリカのニュースを検索します。</p>
        <form method="post" onsubmit="showLoading()" class="row g-3 mb-3">
            <div class="col-md-8">
                <input type="text" name="keyword" class="form-control" placeholder="英語のキーワードを入れてください">
            </div>
            <div class="col-md-2 d-flex align-items-center">
                <div class="form-check">
                    <input class="form-check-input" type="checkbox" name="translate" value="yes" {% if translated %}checked{% endif %}>
                    <label class="form-check-label">
                    翻訳する
                    </label>
                </div>
            </div>
            <div class="col-md-2">
                <button type="submit" class="btn btn-primary w-100">検索</button>
            </div>
        </form>

        <!-- ローディングスピナー -->
        <div id="loading">
            <div class="spinner-border text-primary" role="status" style="width: 3rem; height: 3rem;">
                <span class="visually-hidden">Loading...</span>
            </div>
            <p class="mt-2">検索中です。しばらくお待ちください...</p>
        </div>

        {% if keyword %}
            <h2 class="mt-4">
                "{{ keyword }}"
                の検索結果{% if translated %}(翻訳済み){% endif %}
            </h2>
            <!-- トップページへ戻るボタン -->
            <div class="text-end mt-3">
                <a href="/" class="btn btn-outline-primary btn-sm">トップページへ戻る</a>
            </div>
        {% else %}
            <h2 class="mt-4">トップニュース</h2>
        {% endif %}

        <!-- 記事リスト -->
        <div class="list-group mt-3">
            {% for article in all_articles %}
                <!-- 記事から['url']['title']を取り出す -->
                <a href="{{ article['url'] }}" target="_blank" class="list-group-item list-group-item-action mb-2">
                    <h5>{{ article['title'] }}</h5>
                    <p>{{ article['description'] }}</p>
                    <small class="text-muted">{{ article['source']['name'] }}</small>
                </a>
            {% endfor %}
        </div>

        <!-- ページトップに戻るボタン（固定・右下） -->
        <a href="#" id="scrollTopBtn" class="btn btn-outline-secondary btn-sm" 
        style="position: fixed; bottom: 20px; right: 20px; display: none; border-radius: 50%;">
        ↑
        </a>

        <script>
            // スクロールでトップに戻るボタン表示
            const scrollBtn = document.getElementById('scrollTopBtn');
            window.onscroll = () => {
                scrollBtn.style.display = (document.documentElement.scrollTop > 100) ? 'block' : 'none';
            };

            scrollBtn.onclick = () => {
                window.scrollTo({top:0, behavior:'smooth'});
                return false;
            };

            // フォーム送信時にローディングスピナー表示
            function showLoading() {
            document.getElementById('loading').style.display = 'flex'; // 検索ボタン押したときだけ表示
            }
        </script>
    </body>
</html>
